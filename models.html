<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenConstruction • Models</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* ---------- Design tokens (LIGHT ONLY) ---------- */
    :root{
      --oc-bg:#fff; --oc-text:#1e2a36; --oc-sub:#6b7b8c;
      --oc-border:#e7edf3; --oc-ink:#0f2e4b; --oc-link:#0b66c3;
      --oc-card:#fff; --oc-shadow:0 8px 24px rgba(15,46,75,.06);
      --oc-radius:14px; --oc-muted:#f6f9fc;
      --oc-brand:#0f2e4b; --oc-accent:#f2a238;
    }
    html,body{background:var(--oc-bg); color:var(--oc-text)}
    a{color:var(--oc-link)}

    /* ---------- Navbar (match index.html) ---------- */
    .oc-nav{backdrop-filter:saturate(120%) blur(6px)}
    .oc-logo{height:44px;width:44px}
    .brand-wordmark{
      display:inline-flex;gap:.25rem;align-items:baseline;
      color:#0F2E4B;font-weight:700;letter-spacing:.1px;
      font-size:clamp(1.1rem,1.1rem + .4vw,1.35rem)
    }
    .brand-wordmark .oc-open{font-weight:600;opacity:.95}
    .brand-wordmark .oc-sep{opacity:.35;margin:0 .15rem}
    .brand-wordmark .oc-construction{font-weight:800;letter-spacing:.15px}
    .navbar .nav-link.plain{font-weight:700;color:var(--oc-text);padding:.5rem .6rem}
    .navbar .nav-link.plain:hover,.navbar .nav-link.plain.active{
      color:var(--oc-ink);text-decoration:underline;text-underline-offset:3px
    }
    .nav-link.icon-only{line-height:1;padding-top:.375rem;padding-bottom:.375rem}
    .nav-link.icon-only svg{display:block;width:20px;height:20px;color:inherit;opacity:.9}
    .nav-link.icon-only:hover svg{opacity:1}

    /* ---------- Docked search (same as index) ---------- */
    .navbar-search{display:none;width:clamp(200px,24vw,320px)}
    .navbar-search .form-control{
      height:34px;padding:.25rem .75rem;font-size:.875rem;line-height:1.2;border-radius:999px
    }
    body.docked .navbar-search{display:flex}
    body.docked #searchDock{display:none}
    @media (min-width: 992px){
      .navbar .container{display:flex;align-items:center}
      .navbar .navbar-collapse{flex-grow:0}
      .navbar .navbar-search{margin-left:.75rem}
    }

    /* ---------- Hero ---------- */
    header.hero{border-bottom:1px solid var(--oc-border);background:#fff}
    header.hero .content{padding:56px 0 36px;text-align:center}
    header.hero h1{font-weight:800;color:var(--oc-brand);margin-bottom:.3rem}
    header.hero p{color:var(--oc-sub);margin:0 auto;max-width:72ch}
    .search-input{
      border-radius:999px;padding:.9rem 1.1rem;max-width:720px;margin:0 auto;
      box-shadow:inset 0 1px 0 rgba(15,46,75,.05)
    }

    /* ---------- Filters ---------- */
    .filters{position:sticky;top:86px}
    .facet-list{max-height:280px;overflow:auto;border:1px solid var(--oc-border);border-radius:.5rem;padding:.55rem;background:var(--oc-card)}
    .card .form-label{font-weight:700}
    .range-container{position:relative;height:36px;margin:.25rem 0 .5rem}
    .range-container .slider{position:absolute;left:10px;right:10px;top:14px;height:8px;background:#e9ecef;border-radius:10px}
    .range-container .range-selected{position:absolute;top:14px;height:8px;background:#0d6efd;border-radius:10px}
    .range-container .thumb{pointer-events:none;position:absolute;height:0;width:100%;-webkit-appearance:none}
    .range-container .thumb::-webkit-slider-thumb{
      pointer-events:all;width:18px;height:18px;border-radius:50%;background:#0d6efd;border:2px solid #fff;box-shadow:0 0 0 1px rgba(0,0,0,.12);-webkit-appearance:none
    }
    .range-container .thumb::-moz-range-thumb{
      pointer-events:all;width:18px;height:18px;border-radius:50%;background:#0d6efd;border:2px solid #fff
    }

    .toolbar{display:flex;justify-content:space-between;align-items:center;gap:.75rem;flex-wrap:wrap}

    /* ---------- Paper / Model card ---------- */
    .paper-card{
      background:var(--oc-card);border:1px solid var(--oc-border);border-radius:var(--oc-radius);
      box-shadow:var(--oc-shadow);padding:1rem;height:100%
    }
    .paper-card .left{
      width:84px;height:84px;flex:0 0 84px;border-radius:12px;background:#f4f7fb;
      display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid var(--oc-border)
    }
    .paper-card img{max-width:100%;max-height:100%;object-fit:contain}
    .paper-card .title{font-weight:700;color:var(--oc-ink);margin:0 0 .25rem}
    .paper-card .meta{font-size:.85rem;color:var(--oc-sub)}
    .badge-soft{background:var(--oc-muted);border:1px solid var(--oc-border);color:var(--oc-text);font-weight:600}

    .empty{border:1px dashed var(--oc-border);border-radius:12px;padding:24px;text-align:center;color:var(--oc-sub)}
    .skeleton{position:relative;overflow:hidden;background:var(--oc-muted);border-radius:10px;min-height:120px}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent);animation:shimmer 1.1s infinite;mix-blend-mode:overlay}
    @keyframes shimmer{to{transform:translateX(100%)}}
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top oc-nav">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
      <img src="assets/img/icon.png" alt="OpenConstruction logo" class="oc-logo" height="44" width="44">
      <span class="brand-wordmark">
        <span class="oc-open">Open</span><span class="oc-sep">·</span><span class="oc-construction">Construction</span>
      </span>
    </a>

    <!-- Docked search (small) -->
    <form class="navbar-search ms-3" role="search" onsubmit="return false;">
      <input id="qDock" type="text" class="form-control oc-search" placeholder="Search models, papers, tasks …" aria-label="Search models">
    </form>

    <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsExample">
      <ul class="navbar-nav ms-auto align-items-lg-center gap-2">
        <li class="nav-item"><a class="nav-link plain" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link plain" href="dataset.html">Datasets</a></li>
        <li class="nav-item"><a class="nav-link plain active" href="models.html" aria-current="page">Models</a></li>
        <li class="nav-item"><a class="nav-link plain" href="contributors.html">Community</a></li>
        <li class="nav-item">
          <a class="nav-link px-2 icon-only" href="https://github.com/ruoxinx/OpenConstruction-Datasets" target="_blank" rel="noopener"
             aria-label="OpenConstruction GitHub" title="View on GitHub">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 
              2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 
              0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52
              0-.53.63-.01 1.08.58 1.23.82.72 1.21 
              1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 
              0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 
              0 0 .67-.21 2.2.82a7.65 7.65 0 0 1 2-.27c.68 0 
              1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 
              1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 
              0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 
              1.48 0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8.013 
              8.013 0 0 0 16 8c0-4.42-3.58-8-8-8"/></svg>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Hero -->
<header class="hero">
  <div class="container content">
    <h1 class="display-6 fw-bold">OpenConstruction Model Catalog</h1>
    <p class="lead">Explore open models for construction monitoring and analysis</p>
    <div id="searchDock" class="mt-3">
      <!-- CENTER search (large) -->
      <input id="q" type="text" class="form-control form-control-lg search-input" placeholder="Search models, papers, tasks …" aria-label="Search models large">
    </div>
  </div>
</header>

<main class="container my-4">
  <div class="row g-3">
    <!-- Filters -->
    <aside class="col-lg-3">
      <div class="card shadow-sm filters">
        <div class="card-header"><strong>Filters</strong></div>
        <div class="card-body small">
          <div class="mb-3">
            <label class="form-label" for="filter-modality">Modalities</label>
            <div id="filter-modality" class="facet-list vstack gap-1"></div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="taskSearch">Tasks</label>
            <input id="taskSearch" type="text" class="form-control form-control-sm mb-2" placeholder="Search tasks…">
            <div id="filter-task" class="facet-list"></div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="licenseSearch">Licenses</label>
            <input id="licenseSearch" type="text" class="form-control form-control-sm mb-2" placeholder="Search licenses…">
            <div id="filter-license" class="facet-list"></div>
          </div>

          <div class="mb-1">
            <label class="form-label">Release year</label>
            <div class="range-container">
              <div class="slider"></div>
              <div class="range-selected" id="yearRangeSelected"></div>
              <input type="range" class="thumb" id="yearRangeMin" min="2005" max="2030" step="1" aria-label="Min year">
              <input type="range" class="thumb" id="yearRangeMax" min="2005" max="2030" step="1" aria-label="Max year">
            </div>
            <div class="small text-muted">From <span id="yearRangeMinVal"></span> to <span id="yearRangeMaxVal"></span></div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Results -->
    <section class="col-lg-9">
      <div class="toolbar mb-2">
        <div><span id="resultCount" class="fw-semibold">0</span> models</div>
        <div class="d-flex align-items-center gap-2">
          <label for="sortBy" class="me-1 small">Sort by</label>
          <select id="sortBy" class="form-select form-select-sm w-auto">
            <option value="year-desc" selected>Year ↓</option>
            <option value="year-asc">Year ↑</option>
            <option value="name-asc">Title A→Z</option>
            <option value="name-desc">Title Z→A</option>
          </select>
        </div>
      </div>

      <div id="modelGrid" class="vstack gap-3" aria-live="polite" aria-busy="true">
        <div class="skeleton" style="height:120px"></div>
        <div class="skeleton" style="height:120px"></div>
        <div class="skeleton" style="height:120px"></div>
      </div>

      <div id="emptyState" class="empty mt-3 d-none">No models match your filters. Try clearing some filters or changing the search.</div>
    </section>
  </div>
</main>

<footer class="border-top py-4 mt-5">
  <div class="container small text-muted">© <span id="yearNow"></span> OpenConstruction</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ---------------------------
   Inline MODEL METADATA (swap to JSON later)
--------------------------- */
const MODELS = [
  {
    id:"oc-safety-clip",
    title:"OC-Safety-CLIP: Contrastive Pretraining for PPE and Hazard Awareness in Construction",
    year:2023,
    modalities:["image"],
    tasks:["PPE detection","hazard recognition"],
    license:"Apache-2.0",
    paper_url:"#",
    code_url:"#",
    icon:"assets/img/model-icons/clip.png"
  },
  {
    id:"oc-bim-llm",
    title:"BIM-LLM: Instruction-tuned LLM for Quantity Takeoff and RFI Drafting",
    year:2024,
    modalities:["text"],
    tasks:["quantity takeoff","document QA","RFI drafting"],
    license:"CC BY-NC 4.0",
    paper_url:"#",
    code_url:"#",
    icon:"assets/img/model-icons/llm.png"
  },
  {
    id:"transformer-xl",
    title:"Transformer-XL: Attentive Language Models Beyond a Fixed-Length Context",
    year:2019,
    modalities:["text"],
    tasks:["language modelling"],
    license:"MIT",
    paper_url:"https://arxiv.org/abs/1901.02860",
    code_url:"https://github.com/kimiyoung/transformer-xl",
    icon:"assets/img/model-icons/txl.png"
  },
  {
    id:"multimodal-progress",
    title:"MultiModal-Progress: Vision+Text Model for Progress Estimation from Photos and Logs",
    year:2022,
    modalities:["image","text"],
    tasks:["progress tracking"],
    license:"Apache-2.0",
    paper_url:"#",
    code_url:"#",
    icon:"assets/img/model-icons/multimodal.png"
  }
];

/* ---- Fallback icon (inline SVG) ---- */
const ICON_FALLBACK = 'data:image/svg+xml;utf8,' + encodeURIComponent(
  `<svg xmlns="http://www.w3.org/2000/svg" width="84" height="84" viewBox="0 0 84 84">
     <rect width="84" height="84" rx="12" fill="#f1f5f9"/>
     <path d="M18 54h48v6H18zM24 24h12v24H24zM48 36h12v12H48z" fill="#0f2e4b" opacity=".65"/>
   </svg>`
);

/* ---------------------------
   Helpers
--------------------------- */
const byId = id => document.getElementById(id);
function uniqSorted(arr){ return Array.from(new Set(arr)).sort((a,b)=> a.localeCompare(b,undefined,{sensitivity:'base'})); }
function yearExtent(items){
  const ys = items.map(d=>d.year).filter(y=>typeof y==='number' && !isNaN(y));
  if(!ys.length) return [2005, new Date().getFullYear()];
  return [Math.min(...ys), Math.max(...ys)];
}
function makeCheckbox(id, label, value){
  const wrap = document.createElement('div'); wrap.className = 'form-check';
  const input = document.createElement('input'); input.className='form-check-input'; input.type='checkbox'; input.id=id; input.value=value;
  const lab = document.createElement('label'); lab.className='form-check-label'; lab.setAttribute('for', id); lab.textContent=label;
  wrap.appendChild(input); wrap.appendChild(lab); return wrap;
}
function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

/* ---------------------------
   State + facets
--------------------------- */
const state = {
  q: '', sort: 'year-desc',
  tasks: new Set(), modalities: new Set(), licenses: new Set(),
  yMin: null, yMax: null
};

function buildFacets(){
  // Modalities
  const modVals = uniqSorted(MODELS.flatMap(m=>m.modalities||[]));
  const modWrap = byId('filter-modality'); modWrap.innerHTML='';
  modVals.forEach((m,i)=> modWrap.appendChild(makeCheckbox('m_'+i, m, m)));

  // Tasks
  const taskVals = uniqSorted(MODELS.flatMap(m=>m.tasks||[]));
  const taskWrap = byId('filter-task'); taskWrap.innerHTML='';
  taskVals.forEach((t,i)=> taskWrap.appendChild(makeCheckbox('t_'+i, t, t)));

  // Licenses
  const licVals = uniqSorted(MODELS.map(m=>m.license).filter(Boolean));
  const licWrap = byId('filter-license'); licWrap.innerHTML='';
  licVals.forEach((l,i)=> licWrap.appendChild(makeCheckbox('l_'+i, l, l)));

  // Year range
  const [minY, maxY] = yearExtent(MODELS);
  const rmin = byId('yearRangeMin'), rmax = byId('yearRangeMax');
  rmin.min = rmax.min = String(minY);
  rmin.max = rmax.max = String(maxY);
  rmin.value = String(minY); rmax.value = String(maxY);
  state.yMin = minY; state.yMax = maxY;
  updateTrack();
}

/* ---------------------------
   Filter + sort + render
--------------------------- */
function applyFilters(){
  const q = state.q.trim().toLowerCase();

  let rows = MODELS.filter(m=>{
    const text = [m.title,(m.tasks||[]).join(' '),(m.modalities||[]).join(' '),m.license].join(' ').toLowerCase();
    if(q && !text.includes(q)) return false;

    if(state.tasks.size){
      const set = new Set(m.tasks||[]);
      for(const t of state.tasks){ if(!set.has(t)) return false; }
    }
    if(state.modalities.size){
      const set = new Set(m.modalities||[]);
      for(const mo of state.modalities){ if(!set.has(mo)) return false; }
    }
    if(state.licenses.size && !state.licenses.has(m.license)) return false;

    if((m.year||0) < state.yMin || (m.year||0) > state.yMax) return false;

    return true;
  });

  switch(state.sort){
    case 'name-asc':  rows.sort((a,b)=> a.title.localeCompare(b.title)); break;
    case 'name-desc': rows.sort((a,b)=> b.title.localeCompare(a.title)); break;
    case 'year-asc':  rows.sort((a,b)=> (a.year||0)-(b.year||0)); break;
    default:          rows.sort((a,b)=> (b.year||0)-(a.year||0));
  }

  render(rows);
}

function render(items){
  const grid = byId('modelGrid');
  grid.innerHTML = '';
  byId('resultCount').textContent = items.length;

  if(items.length===0){ byId('emptyState').classList.remove('d-none'); return; }
  byId('emptyState').classList.add('d-none');

  items.forEach(m=>{
    const el = document.createElement('div');
    el.className = 'paper-card';
    el.innerHTML = `
      <div class="d-flex gap-3 align-items-start">
        <div class="left">
          <img src="${m.icon||ICON_FALLBACK}" alt="" onerror="this.src='${ICON_FALLBACK}'">
        </div>
        <div class="flex-grow-1">
          <h3 class="h6 title mb-1">${m.title}</h3>
          <div class="meta mb-2">${m.year||'—'} • ${(m.modalities||[]).join(', ') || '—'} • ${m.license||'—'}</div>
          <div class="d-flex flex-wrap gap-1 mb-3">
            ${(m.tasks||[]).map(t=>`<span class="badge badge-soft rounded-pill px-2 py-1">${t}</span>`).join('')}
          </div>
          <div class="d-flex gap-2">
            ${m.paper_url ? `<a class="btn btn-sm btn-primary" href="${m.paper_url}" target="_blank" rel="noopener">Paper</a>`:''}
            ${m.code_url ? `<a class="btn btn-sm btn-outline-secondary" href="${m.code_url}" target="_blank" rel="noopener">Code</a>`:''}
          </div>
        </div>
      </div>`;
    grid.appendChild(el);
  });
}

/* ---------------------------
   Wire up controls
--------------------------- */
function readFacet(containerId, setRef){
  setRef.clear();
  byId(containerId).querySelectorAll('input[type=checkbox]:checked').forEach(c=> setRef.add(c.value));
}
function attachFacetHandlers(){
  // Modalities
  byId('filter-modality').addEventListener('change', ()=>{ readFacet('filter-modality', state.modalities); applyFilters(); });
  // Tasks (with search)
  byId('filter-task').addEventListener('change', ()=>{ readFacet('filter-task', state.tasks); applyFilters(); });
  byId('taskSearch').addEventListener('input', debounce(e=>{
    const q = e.target.value.toLowerCase();
    byId('filter-task').querySelectorAll('.form-check').forEach(w=>{
      const label = w.querySelector('label').textContent.toLowerCase();
      w.style.display = label.includes(q)?'':'none';
    });
  }, 120));
  // Licenses
  byId('filter-license').addEventListener('change', ()=>{ readFacet('filter-license', state.licenses); applyFilters(); });
  byId('licenseSearch').addEventListener('input', debounce(e=>{
    const q = e.target.value.toLowerCase();
    byId('filter-license').querySelectorAll('.form-check').forEach(w=>{
      const label = w.querySelector('label').textContent.toLowerCase();
      w.style.display = label.includes(q)?'':'none';
    });
  }, 120));

  // Search (hero + docked) with sync
  const heroInput = byId('q'), dockInput = byId('qDock');
  function sync(to, from){ to.value = from.value; to.dispatchEvent(new Event('input',{bubbles:true})); }
  if (dockInput && heroInput){
    const updateQ = debounce(()=>{ state.q = heroInput.value; if (!document.body.classList.contains('docked')) dockInput.value = heroInput.value; applyFilters(); }, 120);
    dockInput.addEventListener('input', ()=>{ state.q = dockInput.value; sync(heroInput, dockInput); applyFilters(); });
    heroInput.addEventListener('input', updateQ);
  }

  // Docked search show/hide (same style as index) with hysteresis
  (function(){
    const SHOW_AT = 220;   // show navbar search after this
    const HIDE_AT = 160;   // hide when scrolling back above this
    let docked = false;
    function setDock(on){ if(on===docked) return; docked=on; document.body.classList.toggle('docked', on); }
    function onScroll(){
      const y = window.scrollY || 0;
      if(!docked && y > SHOW_AT) setDock(true);
      else if(docked && y < HIDE_AT) setDock(false);
    }
    onScroll();
    window.addEventListener('scroll', onScroll, {passive:true});
  })();

  // Sort
  byId('sortBy').addEventListener('change', (e)=>{ state.sort = e.target.value; applyFilters(); });
}

/* ---------- Year selected track bar ---------- */
const rmin = byId('yearRangeMin'), rmax = byId('yearRangeMax'),
      track = byId('yearRangeSelected'), minVal = byId('yearRangeMinVal'), maxVal = byId('yearRangeMaxVal');
function updateTrack(){
  const minYear = +rmin.min, maxYear = +rmax.max;
  const a = Math.min(+rmin.value || minYear, +rmax.value || maxYear);
  const b = Math.max(+rmin.value || minYear, +rmax.value || maxYear);
  const left = ((a - minYear) / (maxYear - minYear)) * 100;
  const right = 100 - ((b - minYear) / (maxYear - minYear)) * 100;
  track.style.left = `calc(${left}% + 10px)`;
  track.style.right = `calc(${right}% + 10px)`;
  minVal.textContent = a; maxVal.textContent = b;
  state.yMin = a; state.yMax = b;
}
['input','change'].forEach(ev=>{
  rmin.addEventListener(ev, ()=>{ updateTrack(); applyFilters(); });
  rmax.addEventListener(ev, ()=>{ updateTrack(); applyFilters(); });
});

/* ---------- Init ---------- */
(function init(){
  byId('yearNow').textContent = new Date().getFullYear();
  buildFacets();
  attachFacetHandlers();
  applyFilters();
})();
</script>

<!-- (Optional) Supabase visit logger (kept consistent with index) -->
<script>
(async function(){
  const PAGE = 'models';
  if(!('SUPABASE_URL' in window) || !('SUPABASE_ANON_KEY' in window) || !window.supabase){ return; }
  const sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
  async function sha256hex(text){ const enc=new TextEncoder().encode(text); const buf=await crypto.subtle.digest('SHA-256',enc); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
  function getVisitorId(){ const k='oc_visitor_id'; let v=localStorage.getItem(k); if(!v){ v=(crypto.randomUUID?crypto.randomUUID():(Date.now()+'-'+Math.random().toString(36).slice(2))); localStorage.setItem(k,v);} return v; }
  async function getGeo(){ try{ const g=await fetch('https://get.geojs.io/v1/ip/geo.json',{cache:'no-store'}).then(r=>r.json()); if(g&&g.latitude&&g.longitude) return { ip:g.ip||null, lat:+g.latitude, lon:+g.longitude, city:g.city||null, region:g.region||null, country:g.country||null }; }catch(e){} return null; }
  try{
    const geo=await getGeo(); const base=geo?.ip?geo.ip:('vid:'+getVisitorId()); const ip_hash=await sha256hex(base);
    const payload={page:PAGE, ip_hash, city:geo?.city||null, region:geo?.region||null, country:geo?.country||null,
      lat:(geo&&typeof geo.lat==='number')?geo.lat:null, lon:(geo&&typeof geo.lon==='number')?geo.lon:null,
      ua:navigator.userAgent, referrer: document.referrer||null};
    const { error } = await sb.from('visits').insert(payload);
    if(error) console.error('insert error', error);
  }catch(e){ console.error('logger failed', e); }
})();
</script>

<!-- Floating button: Add New Dataset -->
<a href="https://github.com/ruoxinx/OpenConstruction-Models/issues/new?template=new_model.yml"
   class="issue-btn" target="_blank" rel="noopener">
   Add New Model
</a>

<style>
  .issue-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1050;
    background: #0d6efd; /* Bootstrap blue */
    color: #fff;
    padding: 12px 20px;
    border-radius: 999px;
    font-weight: 600;
    font-size: .9rem;
    box-shadow: 0 4px 12px rgba(0,0,0,.25);
    text-decoration: none;
    transition: background .2s ease, transform .2s ease;
  }
  .issue-btn:hover {
    background: #0b5ed7;
    transform: translateY(-2px);
    color: #fff;
    text-decoration: none;
  }
</style>




</body>
</html>
