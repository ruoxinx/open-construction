<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenConstruction · Education</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --oc-bg:#fff; --oc-text:#1e2a36; --oc-sub:#6b7b8c;
      --oc-border:#e7edf3; --oc-ink:#0f2e4b; --oc-link:#0b66c3;
      --oc-card:#fff; --oc-shadow:0 8px 24px rgba(15,46,75,.06);
      --oc-radius:14px; --oc-muted:#f6f9fc;
      --oc-brand:#0f2e4b; --oc-accent:#f2a238;
      --tag-text:#344454; --tag-bg:#f8fafc; --tag-border:#dce3eb;
    }
    html,body{background:var(--oc-bg);color:var(--oc-text)}
    a{color:var(--oc-link)}
    .oer-card{background:var(--oc-card);border-radius:var(--oc-radius);box-shadow:var(--oc-shadow);padding:1rem}
    .tag-section{margin-top:.25rem}
    .tag-title{font-size:.75rem;font-weight:600;color:var(--oc-sub);margin-bottom:.25rem}
    .tag{display:inline-block;background:var(--tag-bg);border:1px solid var(--tag-border);border-radius:8px;padding:.2em .6em;font-size:.75rem;margin:.15em .3em .15em 0;color:var(--tag-text)}
  </style>
</head>
<body>

<header class="hero p-4 text-center border-bottom">
  <h1 class="display-6 fw-bold">OpenConstruction Educational Resources</h1>
  <p class="lead">Explore open educational resources for construction education</p>
  <input id="q" type="text" class="form-control form-control-lg mx-auto" style="max-width:480px" placeholder="Search titles, topics, authors …" aria-label="Search OER large">
</header>

<main class="container my-4">
  <div class="row g-3">
    <aside class="col-lg-3">
      <div class="card shadow-sm filters">
        <div class="card-header"><strong>Filters</strong></div>
        <div class="card-body small">
          <div class="mb-3"><label class="form-label">Language</label><div id="filter-language" class="facet-list vstack gap-1"></div></div>
          <div class="mb-3"><label class="form-label">Topics</label><div id="filter-topics" class="facet-list vstack gap-1"></div></div>
          <div class="mb-3"><label class="form-label">License</label><div id="filter-license" class="facet-list vstack gap-1"></div></div>
          <div class="mb-3"><label class="form-label">Media</label><div id="filter-media" class="facet-list vstack gap-1"></div></div>
        </div>
      </div>
    </aside>

    <section class="col-lg-9">
      <div class="toolbar mb-2 d-flex justify-content-between align-items-center">
        <div><span id="resultCount" class="fw-semibold">0</span> resources</div>
        <div class="d-flex align-items-center gap-2">
          <label for="sortBy" class="form-label mb-0 small text-muted">Sort by</label>
          <select id="sortBy" class="form-select form-select-sm w-auto">
            <option value="added-desc">Added date ↓</option>
            <option value="added-asc">Added date ↑</option>
            <option value="name-asc">Name A–Z</option>
            <option value="name-desc">Name Z–A</option>
          </select>
        </div>
      </div>

      <div id="oerGrid" class="vstack gap-3" aria-live="polite" aria-busy="true"></div>
      <div id="emptyState" class="empty d-none mt-4">No results found.</div>
      <div id="errorState" class="empty mt-3 d-none text-danger">Failed to load OER JSON.</div>
    </section>
  </div>
</main>

<footer class="py-4 mt-3 border-top text-center small text-muted">
  © <span id="yearNow"></span> OpenConstruction
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const PLACEHOLDER = 'assets/img/oer/_placeholder.png';
const ICON_FALLBACK = 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="160" height="120" viewBox="0 0 160 120"><rect width="160" height="120" rx="12" fill="#f1f5f9"/><g fill="#0f2e4b" opacity=".6"><rect x="24" y="76" width="112" height="8" rx="4"/><rect x="36" y="28" width="28" height="36" rx="6"/><rect x="88" y="44" width="36" height="20" rx="6"/></g></svg>');

function byId(id){return document.getElementById(id);}
function sec(label, arr, cls=''){
  return (Array.isArray(arr) && arr.length)
    ? `<div class="tag-section"><div class="tag-title">${label}</div><div class="tags">${arr.map(t=>`<span class="tag ${cls}">${t}</span>`).join('')}</div></div>`
    : '';
}

/* ✅ Only this render() section changed */
function render(items){
  const grid = byId('oerGrid');
  const empty = byId('emptyState');
  const err = byId('errorState');
  grid.innerHTML = '';
  if (err) err.classList.add('d-none');
  byId('resultCount').textContent = items.length;

  if (!items.length) { empty.classList.remove('d-none'); return; }
  empty.classList.add('d-none');

  items.forEach(o => {
    const img = o.image || o.thumbnail || PLACEHOLDER;
    const addedTxt = o._added_fmt ? `Added ${o._added_fmt}` : '';
    const authorsLine = Array.isArray(o.authors) ? o.authors.join(', ') : (o.authors || '');
    const providerOrAuthors = authorsLine || o.provider || '';

    const tagsHTML =
      sec('Topics',   o.topics,   'topic') +
      sec('Media',    o.media,    'media') +
      sec('Language', o.language, 'lang');

    const publisherHTML = o.publisher ? sec('Publisher', [o.publisher], 'publisher') : '';
    const institutionsHTML = (Array.isArray(o.institutions) && o.institutions.length)
      ? sec('Institution(s)', o.institutions, 'inst') : '';

    const card = document.createElement('div');
    card.className = 'oer-card';
    card.innerHTML = `
      <div class="d-flex gap-3 align-items-start">
        <div class="left">
          <img src="${img}" alt="${o.title || 'thumbnail'}"
               onerror="this.onerror=null; this.src='${PLACEHOLDER}'; this.setAttribute('onerror', 'this.src=\\'${ICON_FALLBACK}\\'');">
        </div>

        <div class="flex-grow-1">
          <h3 class="h6 title mb-1">${o.title || 'Untitled'}</h3>
          <div class="meta mb-1">
            ${providerOrAuthors ? providerOrAuthors + ' • ' : ''}${o.year || '—'}
          </div>

          ${tagsHTML}
          ${publisherHTML}
          ${institutionsHTML}

          <div class="d-flex flex-wrap align-items-center gap-2 mt-2">
            ${o.source ? `<a class="btn btn-sm btn-primary" href="${o.source}" target="_blank" rel="noopener">View resource</a>` : ''}
            ${o._added_fmt ? `<span class="added-note ms-auto">${addedTxt}</span>` : ''}
          </div>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}
</script>
</body>
</html>
