<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="shortcut icon" href="/favicon.ico">
  <meta name="theme-color" content="#0f2e4b">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenConstruction · Object Class</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --oc-bg:#ffffff; --oc-text:#1e2a36; --oc-subtle:#6b7b8c; --oc-border:#e7edf3;
      --oc-ink:#0f2e4b; --oc-accent:#f2a238; --oc-link:#0b66c3;
      --oc-card:#ffffff; --oc-shadow:0 8px 24px rgba(15,46,75,.06);
      --oc-radius:14px; --oc-muted:#f6f9fc; --oc-focus:#86b7fe;
    }
    html,body{ background:var(--oc-bg); color:var(--oc-text); }
    a{ color:var(--oc-link); }
    .oc-container{ max-width:1080px; }

    .hl{ background:linear-gradient(180deg,transparent 60%,rgba(242,162,56,.25) 0); padding:0 .06em; font-weight:700; }

    .oc-nav{ backdrop-filter:saturate(120%) blur(6px); border-bottom:1px solid var(--oc-border)!important; }
    .brand-wordmark{ display:flex; flex-direction:column; line-height:1; gap:0; align-items:flex-start; color:#0F2E4B; }
    .brand-wordmark .oc-open{ font-size:.75rem; font-weight:400; letter-spacing:.15em; text-transform:uppercase; opacity:.7; margin-bottom:-.1rem; }
    .brand-wordmark .oc-construction{ font-size:1.35rem; font-weight:700; letter-spacing:-.01em; }
    .oc-logo{ height:44px; width:44px; }
    .navbar .nav-link.plain{ font-weight:700; color:var(--oc-text); padding:.5rem .6rem; }
    .navbar .nav-link.plain:hover,
    .navbar .nav-link.plain.active{ color:var(--oc-ink); text-decoration:underline; text-underline-offset:3px; }

    .oc-section{ margin-top:34px; }
    .oc-kicker{ font-size:.8rem; letter-spacing:.18em; text-transform:uppercase; color:var(--oc-subtle); }
    .oc-card{ background:var(--oc-card); border:1px solid var(--oc-border); border-radius:var(--oc-radius); box-shadow:var(--oc-shadow); }
    .oc-card-body{ padding:1.25rem; }

    .chip{
      border:1px solid var(--oc-border);
      background:#fff;
      border-radius:999px;
      padding:.35rem .6rem;
      font-weight:900;
      font-size:.85rem;
      color:var(--oc-ink);
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
    }

    footer{ border-top:1px solid var(--oc-border); margin-top:44px; padding:18px 0; color:var(--oc-subtle); font-size:.95rem; }
    :focus-visible{ outline:2px solid var(--oc-focus); outline-offset:2px; border-radius:6px; }
  </style>
</head>

<body>
  <!-- NAVBAR (same as other pages; shorten here if you prefer, but keep consistent) -->
  <nav class="navbar navbar-expand-lg bg-white sticky-top oc-nav">
    <div class="container oc-container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
        <img src="assets/img/icon.png" alt="OpenConstruction logo" class="oc-logo">
        <span class="brand-wordmark">
          <span class="oc-open">OpenConstruction</span>
          <span class="oc-construction">Open Science</span>
        </span>
      </a>

      <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample"
              aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarsExample">
        <ul class="navbar-nav ms-auto align-items-lg-center gap-2">
          <li class="nav-item"><a class="nav-link plain" href="dataset.html">Datasets</a></li>
          <li class="nav-item"><a class="nav-link plain" href="models.html">Models</a></li>
          <li class="nav-item"><a class="nav-link plain" href="benchmarks.html">Benchmarks</a></li>
          <li class="nav-item"><a class="nav-link plain active" href="object_taxonomy.html">Taxonomy</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container oc-container">
    <section class="oc-section">
      <div class="oc-kicker mb-2">Object class</div>
      <h1 class="h3 fw-bold" style="color:var(--oc-ink);" id="title">—</h1>
      <p class="text-muted mb-0">
        Canonical key: <code id="canon">—</code>
        · Category: <span class="hl" id="cat">—</span>
      </p>
    </section>

    <section class="oc-section">
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="oc-card h-100"><div class="oc-card-body">
            <div class="oc-kicker mb-2">Aliases merged</div>
            <div id="aliases" class="d-flex flex-wrap gap-2"></div>
          </div></div>
        </div>
        <div class="col-lg-6">
          <div class="oc-card h-100"><div class="oc-card-body">
            <div class="oc-kicker mb-2">Dataset evidence</div>
            <div class="text-muted mb-2"><span id="dsCount">—</span> dataset(s) contain this class.</div>
            <div id="datasets" class="d-flex flex-wrap gap-2"></div>
          </div></div>
        </div>
      </div>
    </section>

    <footer class="py-4 mt-3">
      <div class="container oc-container small text-muted text-center">
        <div>© <span id="yearNow"></span> OpenConstruction Open Science Initiative</div>
        <div class="mt-2">
          <small>
            <strong>Disclaimer:</strong> OpenConstruction indexes publicly accessible research metadata and provides
            links to original sources. We do not host or distribute datasets, models, code or paywalled content.
            All rights remain with the original authors, creators and publishers.
          </small>
        </div>
      </div>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('yearNow').textContent = new Date().getFullYear();

    const esc = (s) => String(s ?? '')
      .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
      .replaceAll('"','&quot;').replaceAll("'","&#39;");

    const normArray = (v) => Array.isArray(v) ? v.filter(Boolean) : (v ? [v] : []);
    const normStr = (v) => (v == null ? '' : String(v).trim());
    function canonKey(s){
      return normStr(s).toLowerCase()
        .replace(/[_/]+/g,' ')
        .replace(/-+/g,' ')
        .replace(/\s+/g,' ')
        .trim();
    }
    function singularize(key){
      const t = canonKey(key);
      if(t.endsWith('ies') && t.length > 4) return t.slice(0,-3) + 'y';
      if(t.endsWith('s') && !t.endsWith('ss') && t.length > 3) return t.slice(0,-1);
      return t;
    }

    const ALIAS = new Map([
      ['hardhat','hard hat'],
      ['helmet','hard hat'],
      ['people','worker'],
      ['person','worker'],
      ['construction worker','worker'],
      ['rebar','reinforcing bar'],
      ['reinforcement bar','reinforcing bar'],
      ['dumptruck','dump truck'],
      ['dump-truck','dump truck'],
      ['cracks','crack']
    ]);
    function mergeAlias(raw){
      const k = canonKey(raw);
      const v = ALIAS.get(k);
      return v ? canonKey(v) : k;
    }

    const CATS = [
      { id:'People', re:/\b(worker|person|people|human|inspector|operator)\b/ },
      { id:'Equipment', re:/\b(crane|excavator|bulldozer|loader|forklift|truck|dump truck|mixer|drone|uav|robot)\b/ },
      { id:'PPE', re:/\b(hard hat|vest|glove|goggle|mask|respirator|harness)\b/ },
      { id:'Materials', re:/\b(concrete|cement|asphalt|steel|reinforcing bar|brick|wood|timber|glass|gypsum|drywall)\b/ },
      { id:'Structural', re:/\b(beam|column|slab|girder|truss|joist|foundation|pile|wall)\b/ },
      { id:'MEP', re:/\b(pipe|duct|hvac|valve|pump|cable|wire|panel|conduit|sprinkler)\b/ },
      { id:'Site', re:/\b(scaffold|scaffolding|formwork|shoring|fence|road|lane|site|stockpile)\b/ },
      { id:'Defects', re:/\b(crack|spall|corrosion|rust|delamination|pothole|defect|damage|leak)\b/ }
    ];
    function inferCat(k){
      const s = canonKey(k);
      for(const c of CATS){ if(c.re.test(s)) return c.id; }
      return 'Other';
    }

    function getParam(name){
      const u = new URL(location.href);
      return u.searchParams.get(name);
    }

    async function loadDatasets(){
      const res = await fetch('data/datasets.json', { cache:'no-store' });
      if(!res.ok) throw new Error('Cannot load data/datasets.json');
      const raw = await res.json();
      const arr = Array.isArray(raw) ? raw : Object.values(raw || {});
      return arr.filter(Boolean);
    }

    async function init(){
      const key = singularize(mergeAlias(getParam('key') || ''));
      const label = getParam('label') || key;

      document.getElementById('title').textContent = label || key;
      document.getElementById('canon').textContent = key;
      document.getElementById('cat').textContent = inferCat(key);

      const datasets = await loadDatasets();

      const aliases = new Set();
      const dsHits = [];

      for(const ds of datasets){
        const dsid = ds.id || ds.name || '';
        const classes = normArray(ds.classes);
        for(const c of classes){
          const canon = singularize(mergeAlias(c));
          if(canon === key){
            aliases.add(normStr(c));
            dsHits.push({ id: dsid, title: ds.name || ds.title || dsid, year: ds.year, url: ds.doi || ds.access || '' });
          }
        }
      }

      // Render aliases
      const aliasEl = document.getElementById('aliases');
      const aliasArr = Array.from(aliases).sort((a,b)=>a.localeCompare(b));
      aliasEl.innerHTML = aliasArr.length
        ? aliasArr.map(a=>`<span class="chip">${esc(a)}</span>`).join('')
        : `<span class="text-muted">—</span>`;

      // Render datasets
      document.getElementById('dsCount').textContent = String(dsHits.length);

      const dsEl = document.getElementById('datasets');
      dsEl.innerHTML = dsHits.length
        ? dsHits.slice(0, 60).map(x=>{
            // Best-effort: link to your dataset page; if you have dataset detail pages, swap URL here.
            return `<a class="chip" href="dataset.html" title="${esc(x.title)}">${esc(x.id)}${x.year ? ' · '+esc(x.year) : ''}</a>`;
          }).join('')
        : `<span class="text-muted">No datasets found.</span>`;
    }

    init().catch(err=>{
      console.warn('[object_class] init error:', err);
      document.getElementById('title').textContent = 'Could not load class details';
    });
  </script>
</body>
</html>
